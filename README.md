# PowerShell 7-Zip CRC32 Calculator

This PowerShell script provides functions to calculate CRC32 checksums for files and folders in a manner that is **100% compatible with the checksums generated by 7-Zip**. It is a pure PowerShell implementation that leverages .NET for high performance, requiring no external executables.

It supports both:
- an interactive GUI mode on Windows, and
- a non-interactive CLI mode suitable for CI systems like GitHub Actions.

## Description

Have you ever wanted to verify the integrity of a folder against a checksum provided by 7-Zip? 7-Zip's "CRC" and "hash" commands generate checksums using a specific, proprietary method, especially for folders. This script replicates that algorithm so you can validate 7-Zip checksums without needing to install 7-Zip.

For folders, it calculates two distinct aggregate checksums:

1. **CRC32 checksum for data:** an aggregate of the CRC32 values of each file's contents.
2. **CRC32 checksum for data and names:** an aggregate that includes file/folder metadata and names (UTF-16LE), mirroring 7-Zip behavior.

## Features

- **7-Zip Compatibility:** Generates checksums identical to 7-Zip outputs.
- **File & Folder Support:** Works on both individual files and whole directory trees.
- **Windows GUI:** Optional picker dialog for interactive Windows usage.
- **CI-Friendly CLI:** Works headlessly for pipelines (GitHub Actions, etc.).
- **Pure PowerShell:** No external dependencies.
- **Unicode Aware:** Handles special characters in file/folder names.

## Requirements

- PowerShell 7+ for cross-platform CI usage.
- Windows PowerShell 5.1+ is still supported for local Windows GUI usage.

## Usage

### CLI mode (recommended for automation)

```powershell
pwsh ./Get-Crc32.ps1 -Path ./some-file.bin
pwsh ./Get-Crc32.ps1 -Path ./some-folder -IncludeRoot $true
pwsh ./Get-Crc32.ps1 -Path ./some-folder -OutputJson
```

When running in CI / GitHub Actions, provide `-Path`. The script will not try to launch a GUI there.

### GUI mode (Windows)

```powershell
pwsh ./Get-Crc32.ps1 -Gui
```

Or run without `-Path` on Windows in a non-CI environment to open the picker automatically.

## GitHub Actions checks

This repository includes:

- `tests/Crc32.Integration.Tests.ps1`: Pester integration tests that build a 7-Zip parity fixture and compare this script output to live `7z` output.
- `.github/workflows/crc32-checks.yml`: workflow that installs 7-Zip (prefers 25.01), installs Pester, and runs integration tests on `windows-latest`.

The checks cover:

1. **Folder aggregate parity against 7-Zip** for include-root mode (`7z h -scrcCRC32 "<TopFolder>"`).
2. **Folder aggregate parity against 7-Zip** for contents-only mode (`7z h -scrcCRC32 "<TopFolder>*" -r`).
3. **Known 7-Zip constants** for the fixture (`3ED73E74-00000003` include-root and `06F61F71-00000002` contents-only).
4. **File mode CRC checks** confirming zero-byte files produce `00000000`.
